<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>WEBDARK - Neon Elite</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #000000; color: #00ff41; font-family: 'Courier New', Courier, monospace; }
        .neon-card { background-color: #050505; border: 1px solid #00ff41; box-shadow: 0 0 20px rgba(0, 255, 65, 0.15); }
        input { background: #000; border: 1px solid #004411; color: #00ff41; outline: none; }
        input:focus { border-color: #00ff41; }
        .loading-bar { height: 2px; background: #00ff41; width: 0%; transition: width 0.5s; }
    </style>
</head>
<body class="p-10 text-center">
    <h1 class="text-4xl font-black mb-10 tracking-tighter uppercase text-green-500">WebDark <span class="text-xs">v2.0</span></h1>
    
    <div class="max-w-xl mx-auto neon-card p-10 rounded-lg">
        <p class="text-xs mb-4 text-green-800 font-bold tracking-widest text-left">>> COMANDO DE ENTRADA</p>
        <input id="tema" type="text" placeholder="DEFINIR TEMA DO VÍDEO..." class="w-full p-4 rounded mb-8">
        
        <button onclick="iniciar()" id="btn" class="w-full bg-green-600 text-black font-black p-4 rounded hover:bg-green-400 transition-all uppercase tracking-widest">
            Executar Protocolo
        </button>

        <div id="statusArea" class="mt-8 hidden">
            <p id="msg" class="text-sm mb-4 animate-pulse">PROCESSANDO DADOS...</p>
            <div class="w-full bg-green-900/30 rounded-full h-1">
                <div id="progresso" class="loading-bar"></div>
            </div>
        </div>
        
        <div id="download" class="mt-10 hidden">
            <a id="link" href="#" target="_blank" class="bg-white text-black px-10 py-4 rounded font-black hover:bg-green-500 transition-all">
                BAIXAR MP4 FINALIZADO
            </a>
        </div>
    </div>

    <script>
        async function iniciar() {
            const tema = document.getElementById('tema').value;
            const msg = document.getElementById('msg');
            const btn = document.getElementById('btn');
            const progresso = document.getElementById('progresso');
            
            if(!tema) return alert("ENTRADA INVÁLIDA");

            document.getElementById('statusArea').classList.remove('hidden');
            btn.disabled = true;
            btn.classList.add('opacity-20');
            progresso.style.width = "30%";

            try {
                const res = await fetch(`https://webdark.onrender.com/gerar-video?tema=${encodeURIComponent(tema)}`, { method: 'POST' });
                const data = await res.json();
                
                msg.innerText = "IA TRABALHANDO NO ARQUIVO... AGUARDE A CONCLUSÃO.";
                progresso.style.width = "60%";

                const check = setInterval(async () => {
                    const sRes = await fetch(`https://webdark.onrender.com/status/${data.id}`);
                    const sData = await sRes.json();
                    
                    if(sData.status === "pronto") {
                        clearInterval(check);
                        progresso.style.width = "100%";
                        msg.innerText = "PROTOCOLO CONCLUÍDO COM SUCESSO.";
                        document.getElementById('link').href = sData.url;
                        document.getElementById('download').classList.remove('hidden');
                        btn.disabled = false;
                        btn.classList.remove('opacity-20');
                    }
                }, 7000); // Verificação um pouco mais lenta para não sobrecarregar o log

            } catch (e) {
                msg.innerText = "FALHA NA CONEXÃO. REINICIE O TERMINAL.";
            }
        }
    </script>
</body>
</html>
