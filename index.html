<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WEBDARK - Automa√ß√£o de V√≠deo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #050505; color: white; }
        .card { background-color: #0f0f0f; border: 1px solid #222; }
        .red-glow { box-shadow: 0 0 15px rgba(153, 0, 0, 0.4); }
        .step-btn { background-color: #141414; padding: 12px; border-radius: 8px; text-align: center; font-size: 11px; color: #555; border: 1px solid #222; }
        .active-step { border: 2px solid #990000; color: white; background-color: #2b0000; }
    </style>
</head>
<body class="p-6 md:p-10 font-sans">

    <div class="flex justify-between items-center mb-10 max-w-6xl mx-auto">
        <div class="flex items-center gap-2">
            <span class="text-2xl">üåë</span>
            <h1 class="text-xl font-black tracking-tighter uppercase text-red-700">WebDark</h1>
        </div>
    </div>

    <div class="grid grid-cols-4 md:grid-cols-8 gap-3 mb-10 max-w-6xl mx-auto">
        <div class="step-btn">Projeto</div>
        <div class="step-btn active-step">Cap√≠tulos</div>
        <div class="step-btn">Revis√£o</div>
        <div class="step-btn">Roteiro</div>
        <div class="step-btn">√Åudio</div>
        <div class="step-btn">Metadata</div>
        <div class="step-btn">Scripts</div>
        <div class="step-btn">Download</div>
    </div>

    <div class="max-w-xl mx-auto card p-8 rounded-2xl red-glow border-t-4 border-t-red-800">
        <h2 class="text-2xl mb-2 text-center font-bold">Gerador de Conte√∫do Dark</h2>
        <p class="text-gray-500 text-center mb-8 text-sm">Insira o tema e a IA criar√° o v√≠deo completo em 720p.</p>
        
        <div class="space-y-6">
            <div>
                <label class="block text-xs font-semibold text-gray-500 uppercase tracking-widest mb-2">Tema do V√≠deo</label>
                <input id="temaInput" type="text" placeholder="Ex: O mist√©rio da Ilha de P√°scoa" 
                       class="w-full bg-black border border-gray-800 p-4 rounded-xl focus:outline-none focus:border-red-700 transition text-white">
            </div>
            
            <button onclick="gerarVideo()" id="btnProcessar"
                    class="w-full bg-red-800 hover:bg-red-700 p-4 rounded-xl font-bold transition flex justify-center items-center gap-3 active:scale-95">
                <span>INICIAR PROCESSAMENTO</span>
            </button>
        </div>

        <div id="statusContainer" class="mt-8 hidden p-4 rounded-lg bg-black border border-red-900/30 text-center">
            <p id="statusTexto" class="text-sm text-red-500 font-medium italic"></p>
            <div id="downloadArea" class="mt-4 hidden">
                <a id="linkDownload" href="#" target="_blank" class="block w-full text-white bg-red-700 px-6 py-3 rounded-lg font-bold hover:bg-red-600 transition">
                    ‚¨áÔ∏è BAIXAR V√çDEO PRONTO
                </a>
            </div>
        </div>
    </div>

    <script>
        async function gerarVideo() {
            const tema = document.getElementById('temaInput').value;
            const statusContainer = document.getElementById('statusContainer');
            const statusTexto = document.getElementById('statusTexto');
            const btn = document.getElementById('btnProcessar');
            const downloadArea = document.getElementById('downloadArea');

            if(!tema) return alert("Por favor, digite um tema.");

            statusContainer.classList.remove('hidden');
            downloadArea.classList.add('hidden');
            statusTexto.innerText = "Conectando ao servidor WEBDARK...";
            btn.disabled = true;
            btn.classList.add('opacity-50');

            try {
                // Rota do seu backend no Render
                const response = await fetch(`https://webdark.onrender.com/gerar-video?tema=${encodeURIComponent(tema)}`, {
                    method: 'POST'
                });

                const data = await response.json();
                statusTexto.innerText = "IA trabalhando... Isso leva cerca de 2 minutos.";
                
                // Come√ßa a verificar se o v√≠deo ficou pronto
                verificarStatus(data.id);

            } catch (error) {
                statusTexto.innerText = "Erro ao conectar. O servidor pode estar dormindo.";
                btn.disabled = false;
                btn.classList.remove('opacity-50');
            }
        }

        async function verificarStatus(id) {
            const statusTexto = document.getElementById('statusTexto');
            const downloadArea = document.getElementById('downloadArea');
            const linkDownload = document.getElementById('linkDownload');

            const intervalo = setInterval(async () => {
                try {
                    const res = await fetch(`https://webdark.onrender.com/status/${id}`);
                    const statusData = await res.json();

                    if (statusData.status === "pronto") {
                        clearInterval(intervalo);
                        statusTexto.innerText = "V√çDEO CONCLU√çDO!";
                        linkDownload.href = statusData.url;
                        downloadArea.classList.remove('hidden');
                    }
                } catch (e) { }
            }, 5000);
        }
    </script>
</body>
</html>
